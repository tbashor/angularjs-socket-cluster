!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.socketCluster=t()}}(function(){return function t(e,n,o){function r(s,c){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return r(n?n:t)},p,p.exports,t,e,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e,n){"use strict";function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,i){e=e||"&",n=n||"=";var s={};if("string"!=typeof t||0===t.length)return s;var c=/\+/g;t=t.split(e);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var u=t.length;a>0&&u>a&&(u=a);for(var p=0;u>p;++p){var l,h,f,d,m=t[p].replace(c,"%20"),y=m.indexOf(n);y>=0?(l=m.substr(0,y),h=m.substr(y+1)):(l=m,h=""),f=decodeURIComponent(l),d=decodeURIComponent(h),o(s,f)?r(s[f])?s[f].push(d):s[f]=[s[f],d]:s[f]=d}return s};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],2:[function(t,e,n){"use strict";function o(t,e){if(t.map)return t.map(e);for(var n=[],o=0;o<t.length;o++)n.push(e(t[o],o));return n}var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,c){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?o(s(t),function(s){var c=encodeURIComponent(r(s))+n;return i(t[s])?o(t[s],function(t){return c+encodeURIComponent(r(t))}).join(e):c+encodeURIComponent(r(t[s]))}).join(e):c?encodeURIComponent(r(c))+n+encodeURIComponent(r(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],3:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":1,"./encode":2}],4:[function(t,e,n){var o=t("./package.json"),r=t("./lib/scsocket");e.exports.SCSocket=r,e.exports.SCEmitter=t("sc-emitter").SCEmitter,e.exports.connect=function(t){return new r(t)},e.exports.version=o.version},{"./lib/scsocket":8,"./package.json":19,"sc-emitter":14}],5:[function(t,e,n){(function(t){var n=function(){this._internalStorage={}};n.prototype.saveToken=function(e,n,o,r){t.localStorage?t.localStorage.setItem(e,n):this._internalStorage[e]=n,r&&r()},n.prototype.removeToken=function(e,n){t.localStorage&&t.localStorage.removeItem(e),delete this._internalStorage[e],n&&n()},n.prototype.loadToken=function(e,n){var o;o=t.localStorage?t.localStorage.getItem(e):this._internalStorage[e]||null,n(null,o)},e.exports.AuthEngine=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(t,e,n){e.exports.create=function(){function t(){}return function(e){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return t.prototype=e,new t}}()},{}],7:[function(t,e,n){var o=function(t,e){this.socket=t,this.id=e};o.prototype._respond=function(t){this.socket.send(this.socket.stringify(t))},o.prototype.end=function(t){if(this.id){var e={rid:this.id};void 0!==t&&(e.data=t),this._respond(e)}},o.prototype.error=function(t,e){if(this.id){var n;n=t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t;var o={rid:this.id,error:n};void 0!==e&&(o.data=e),this._respond(o)}},o.prototype.callback=function(t,e){t?this.error(t,e):this.end(e)},e.exports.Response=o},{}],8:[function(t,e,n){(function(n){var o=t("sc-emitter").SCEmitter,r=t("sc-channel").SCChannel,i=(t("./response").Response,t("./auth").AuthEngine),s=t("./sctransport").SCTransport,c=t("querystring"),a=t("linked-list");Object.create||(Object.create=t("./objectcreate"));var u="undefined"!=typeof window,p=function(t){var e=this;o.call(this);var r={port:null,autoReconnect:!0,autoProcessSubscriptions:!0,ackTimeout:1e4,hostname:n.location&&location.hostname,path:"/socketcluster/",secure:n.location&&"https:"==location.protocol,timestampRequests:!1,timestampParam:"t",authEngine:null,authTokenName:"socketCluster.authToken",binaryType:"arraybuffer"};for(var s in t)t.hasOwnProperty(s)&&(r[s]=t[s]);this.id=null,this.state=this.CLOSED,this.ackTimeout=r.ackTimeout,this.pingTimeout=this.ackTimeout;var p=Math.pow(2,31)-1,l=function(t){if(e[t]>p)throw new Error("The "+t+" value provided exceeded the maximum amount allowed")};if(l("ackTimeout"),l("pingTimeout"),this._localEvents={connect:1,connectAbort:1,disconnect:1,message:1,error:1,raw:1,fail:1,kickOut:1,subscribe:1,unsubscribe:1,authenticate:1,removeAuthToken:1},this._connectAttempts=0,this._emitBuffer=new a,this._channels={},this.options=r,this.options.autoReconnect){null==this.options.autoReconnectOptions&&(this.options.autoReconnectOptions={});var h=this.options.autoReconnectOptions;null==h.initialDelay&&(h.initialDelay=1e4),null==h.randomness&&(h.randomness=1e4),null==h.multiplier&&(h.multiplier=1.5),null==h.maxDelay&&(h.maxDelay=6e4)}if(null==this.options.subscriptionRetryOptions&&(this.options.subscriptionRetryOptions={}),this.auth=this.options.authEngine?this.options.authEngine:new i,this.options.path=this.options.path.replace(/\/$/,"")+"/",this.options.query=r.query||{},"string"==typeof this.options.query&&(this.options.query=c.parse(this.options.query)),this.options.port=r.port||(n.location&&location.port?location.port:this.options.secure?443:80),this.connect(),this._channelEmitter=new o,u){var f=function(){e.disconnect()};n.attachEvent?n.attachEvent("onunload",f):n.addEventListener&&n.addEventListener("beforeunload",f,!1)}};p.prototype=Object.create(o.prototype),p.CONNECTING=p.prototype.CONNECTING=s.prototype.CONNECTING,p.OPEN=p.prototype.OPEN=s.prototype.OPEN,p.CLOSED=p.prototype.CLOSED=s.prototype.CLOSED,p.ignoreStatuses={1e3:"Socket closed normally",1001:"Socket hung up"},p.errorStatuses={1001:"Socket was disconnected",1002:"A WebSocket protocol error was encountered",1003:"Server terminated socket because it received invalid data",1005:"Socket closed without status code",1006:"Socket hung up",1007:"Message format was incorrect",1008:"Encountered a policy violation",1009:"Message was too big to process",1010:"Client ended the connection because the server did not comply with extension requirements",1011:"Server encountered an unexpected fatal condition",4e3:"Server ping timed out",4001:"Client pong timed out",4002:"Server failed to sign auth token",4003:"Failed to complete handshake",4004:"Client failed to save auth token"},p.prototype._privateEventHandlerMap={"#fail":function(t){this._onSCError(t)},"#publish":function(t){var e=this.isSubscribed(t.channel,!0);e&&this._channelEmitter.emit(t.channel,t.data)},"#kickOut":function(t){var e=t.channel,n=this._channels[e];n&&(o.prototype.emit.call(this,"kickOut",t.message,e),n.emit("kickOut",t.message,e),this._triggerChannelUnsubscribe(n))},"#setAuthToken":function(t,e){var n=this;if(t){var r=function(r){r?(e.error(r.message||r),n._onSCError(r)):(o.prototype.emit.call(n,"authenticate",t.token),e.end())};this.auth.saveToken(this.options.authTokenName,t.token,{},r)}else e.error("No token data provided by #setAuthToken event")},"#removeAuthToken":function(t,e){var n=this;this.auth.removeToken(this.options.authTokenName,function(t){t?(e.error(t.message||t),n._onSCError(t)):(o.prototype.emit.call(n,"removeAuthToken"),e.end())})},"#disconnect":function(t){this.transport.close(t.code,t.data)}},p.prototype.getState=function(){return this.state},p.prototype.getBytesReceived=function(){return this.transport.getBytesReceived()},p.prototype.removeAuthToken=function(t){var e=this;this.auth.removeToken(this.options.authTokenName,function(n){t&&t(n),n?e._onSCError(n):o.prototype.emit.call(e,"removeAuthToken")})},p.prototype.connect=p.prototype.open=function(){var t=this;this.state==this.CLOSED&&(clearTimeout(this._reconnectTimeout),this.state=this.CONNECTING,this.transport&&this.transport.off(),this.transport=new s(this.auth,this.options),this.transport.on("open",function(e){t.state=t.OPEN,t._onSCOpen(e)}),this.transport.on("error",function(e){t._onSCError(e)}),this.transport.on("close",function(e,n){t.state=t.CLOSED,t._onSCClose(e,n)}),this.transport.on("openAbort",function(e,n){t.state=t.CLOSED,t._onSCClose(e,n,!0)}),this.transport.on("event",function(e,n,o){t._onSCEvent(e,n,o)}))},p.prototype.reconnect=function(){this.disconnect(),this.connect()},p.prototype.disconnect=function(t,e){if(t=t||1e3,this.state==this.OPEN){var n={code:t,data:e};this.transport.emit("#disconnect",n),this.transport.close(t)}else this.state==this.CONNECTING&&this.transport.close(t)},p.prototype.authenticate=function(t,e){var n=this;this.emit("#authenticate",t,function(r,i){r?e&&e(r,i):n.auth.saveToken(n.options.authTokenName,t,{},function(r){e&&e(r,i),r?n._onSCError(r):i.isAuthenticated&&o.prototype.emit.call(n,"authenticate",t)})})},p.prototype._tryReconnect=function(t){var e,n=this,o=this._connectAttempts++,r=this.options.autoReconnectOptions;if(null==t||o>0){var i=Math.round(r.initialDelay+(r.randomness||0)*Math.random());e=Math.round(i*Math.pow(r.multiplier,o))}else e=t;e>r.maxDelay&&(e=r.maxDelay),clearTimeout(this._reconnectTimeout),this._reconnectTimeout=setTimeout(function(){n.connect()},e)},p.prototype._onSCOpen=function(t){var e=this;t&&(this.id=t.id,this.pingTimeout=t.pingTimeout,this.transport.pingTimeout=this.pingTimeout),this._connectAttempts=0,this.options.autoProcessSubscriptions&&this.processPendingSubscriptions(),o.prototype.emit.call(this,"connect",t,function(){e.processPendingSubscriptions()}),this._flushEmitBuffer()},p.prototype._onSCError=function(t){var e=this;setTimeout(function(){if(e.listeners("error").length<1)throw t;o.prototype.emit.call(e,"error",t)},0)},p.prototype._suspendSubscriptions=function(){var t,e;for(var n in this._channels)this._channels.hasOwnProperty(n)&&(t=this._channels[n],e=t.state==t.SUBSCRIBED||t.state==t.PENDING?t.PENDING:t.UNSUBSCRIBED,this._triggerChannelUnsubscribe(t,e))},p.prototype._onSCClose=function(t,e,n){var r=this;if(this.id=null,this.transport&&this.transport.off(),clearTimeout(this._reconnectTimeout),this._suspendSubscriptions(),n?o.prototype.emit.call(r,"connectAbort",t,e):o.prototype.emit.call(r,"disconnect",t,e),this.options.autoReconnect&&(4e3==t||4001==t||1005==t?this._tryReconnect(0):(1006==t||4003==t)&&this._tryReconnect()),!p.ignoreStatuses[t]){var i=new Error(p.errorStatuses[t]||"Socket connection failed for unknown reasons");i.code=t,this._onSCError(i)}},p.prototype._onSCEvent=function(t,e,n){var r=this._privateEventHandlerMap[t];r?r.call(this,e,n):o.prototype.emit.call(this,t,e,n)},p.prototype.parse=function(t){return this.transport.parse(t)},p.prototype.stringify=function(t){return this.transport.stringify(t)},p.prototype._flushEmitBuffer=function(){for(var t,e=this._emitBuffer.head;e;){t=e.next;var n=e.data;e.detach(),this.transport.emitRaw(n),e=t}},p.prototype._handleEventAckTimeout=function(t,e){var n="Event response for '"+t.event+"' timed out",o=new Error(n);o.type="timeout";var r=t.callback;delete t.callback,e&&e.detach(),r.call(t,o,t),this._onSCError(o)},p.prototype._emit=function(t,e,n){var o=this;this.state==this.CLOSED&&this.connect();var r={event:t,data:e,callback:n},i=new a.Item;i.data=r,n&&(r.timeout=setTimeout(function(){o._handleEventAckTimeout(r,i)},this.ackTimeout)),this._emitBuffer.append(i),this.state==this.OPEN&&this._flushEmitBuffer()},p.prototype.emit=function(t,e,n){null==this._localEvents[t]?this._emit(t,e,n):o.prototype.emit.call(this,t,e)},p.prototype.publish=function(t,e,n){var o={channel:t,data:e};this.emit("#publish",o,function(t){n&&n(t)})},p.prototype._triggerChannelSubscribe=function(t){var e=t.name;t.state!=t.SUBSCRIBED&&(t.state=t.SUBSCRIBED,t.emit("subscribe",e),o.prototype.emit.call(this,"subscribe",e))},p.prototype._triggerChannelSubscribeFail=function(t,e){var n=e.name;e.state!=e.UNSUBSCRIBED&&(e.state=e.UNSUBSCRIBED,e.emit("subscribeFail",t,n),o.prototype.emit.call(this,"subscribeFail",t,n))},p.prototype._cancelPendingSubscribeCallback=function(t){null!=t._pendingSubscriptionCid&&(this.transport.cancelPendingResponse(t._pendingSubscriptionCid),delete t._pendingSubscriptionCid)},p.prototype._trySubscribe=function(t){var e=this;if(this.state==this.OPEN&&null==t._pendingSubscriptionCid){var n={noTimeout:!0};t._pendingSubscriptionCid=this.transport.emit("#subscribe",t.name,n,function(n){delete t._pendingSubscriptionCid,n?e._triggerChannelSubscribeFail(n,t):e._triggerChannelSubscribe(t)})}},p.prototype.subscribe=function(t){var e=this._channels[t];return e||(e=new r(t,this),this._channels[t]=e),e.state==e.UNSUBSCRIBED&&(e.state=e.PENDING,this._trySubscribe(e)),e},p.prototype._triggerChannelUnsubscribe=function(t,e){var n=t.name,r=t.state;t.state=e?e:t.UNSUBSCRIBED,this._cancelPendingSubscribeCallback(t),r==t.SUBSCRIBED&&(t.emit("unsubscribe",n),o.prototype.emit.call(this,"unsubscribe",n))},p.prototype._tryUnsubscribe=function(t){if(this.state==this.OPEN){var e={noTimeout:!0};this._cancelPendingSubscribeCallback(t),this.transport.emit("#unsubscribe",t.name,e)}},p.prototype.unsubscribe=function(t){var e=this._channels[t];e&&e.state!=e.UNSUBSCRIBED&&(this._triggerChannelUnsubscribe(e),this._tryUnsubscribe(e))},p.prototype.channel=function(t){var e=this._channels[t];return e||(e=new r(t,this),this._channels[t]=e),e},p.prototype.destroyChannel=function(t){var e=this._channels[t];e.unwatch(),e.unsubscribe(),delete this._channels[t]},p.prototype.subscriptions=function(t){var e,n,o=[];for(var r in this._channels)this._channels.hasOwnProperty(r)&&(e=this._channels[r],n=t?e&&(e.state==e.SUBSCRIBED||e.state==e.PENDING):e&&e.state==e.SUBSCRIBED,n&&o.push(r));return o},p.prototype.isSubscribed=function(t,e){var t=this._channels[t];return e?!!t&&(t.state==t.SUBSCRIBED||t.state==t.PENDING):!!t&&t.state==t.SUBSCRIBED},p.prototype.processPendingSubscriptions=function(){var t=this,e=[];for(var n in this._channels)this._channels.hasOwnProperty(n)&&e.push(n);for(var o in this._channels)this._channels.hasOwnProperty(o)&&!function(e){e.state==e.PENDING&&t._trySubscribe(e)}(this._channels[o])},p.prototype.watch=function(t,e){this._channelEmitter.on(t,e)},p.prototype.unwatch=function(t,e){e?this._channelEmitter.removeListener(t,e):this._channelEmitter.removeAllListeners(t)},p.prototype.watchers=function(t){return this._channelEmitter.listeners(t)},e.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./auth":5,"./objectcreate":6,"./response":7,"./sctransport":9,"linked-list":11,querystring:3,"sc-channel":12,"sc-emitter":14}],9:[function(t,e,n){var o=t("ws"),r=t("sc-emitter").SCEmitter,i=t("sc-formatter"),s=t("./response").Response,c=t("querystring"),a=function(t,e){this.state=this.CLOSED,this.auth=t,this.options=e,this.pingTimeout=e.ackTimeout,this._cid=1,this._pingTimeoutTicker=null,this._callbackMap={},this.open()};a.prototype=Object.create(r.prototype),a.CONNECTING=a.prototype.CONNECTING="connecting",a.OPEN=a.prototype.OPEN="open",a.CLOSED=a.prototype.CLOSED="closed",a.prototype.uri=function(){var t=this.options.query||{},e=this.options.secure?"wss":"ws",n="";return this.options.port&&("wss"==e&&443!=this.options.port||"ws"==e&&80!=this.options.port)&&(n=":"+this.options.port),this.options.timestampRequests&&(t[this.options.timestampParam]=(new Date).getTime()),t=c.stringify(t),t.length&&(t="?"+t),e+"://"+this.options.hostname+n+this.options.path+t},a.prototype._nextCallId=function(){return this._cid++},a.prototype.open=function(){var t=this;this.state=this.CONNECTING;var e=this.uri(),n=new o(e,null,this.options);n.binaryType=this.options.binaryType,this.socket=n,n.onopen=function(){t._onOpen()},n.onclose=function(e){t._onClose(e.code,e.reason)},n.onmessage=function(e,n){t._onMessage(e.data)}},a.prototype._onOpen=function(){var t=this;this._resetPingTimeout(),this._handshake(function(e,n){e?(t._onError(e),t._onClose(4003),t.socket.close(4003)):(t.state=t.OPEN,r.prototype.emit.call(t,"open",n),t._resetPingTimeout())})},a.prototype._handshake=function(t){var e=this;this.auth.loadToken(this.options.authTokenName,function(n,o){if(n)t(n);else{var r={force:!0};e.emit("#handshake",{authToken:o},r,t)}})},a.prototype._onClose=function(t,e){delete this.socket.onopen,delete this.socket.onclose,delete this.socket.onmessage,this.state==this.OPEN?(this.state=this.CLOSED,r.prototype.emit.call(this,"close",t,e)):this.state==this.CONNECTING&&(this.state=this.CLOSED,r.prototype.emit.call(this,"openAbort",t,e))},a.prototype._onMessage=function(t){if(r.prototype.emit.call(this,"event","message",t),"1"==t)this._resetPingTimeout(),this.socket.readyState==this.socket.OPEN&&this.socket.send("2");else{var e;try{e=this.parse(t)}catch(n){e=t}var o=e.event;if(o){var i=new s(this,e.cid);r.prototype.emit.call(this,"event",o,e.data,i)}else if(null!=e.rid){var c=this._callbackMap[e.rid];c&&(clearTimeout(c.timeout),delete this._callbackMap[e.rid],c.callback(e.error,e.data)),e.error&&this._onError(e.error)}else r.prototype.emit.call(this,"event","raw",e)}},a.prototype._onError=function(t){r.prototype.emit.call(this,"error",t)},a.prototype._resetPingTimeout=function(){{var t=this;(new Date).getTime()}clearTimeout(this._pingTimeoutTicker),this._pingTimeoutTicker=setTimeout(function(){t._onClose(4e3),t.socket.close(4e3)},this.pingTimeout)},a.prototype.getBytesReceived=function(){return this.socket.bytesReceived},a.prototype.close=function(t,e){if(t=t||1e3,this.state==this.OPEN){var n={code:t,data:e};this.emit("#disconnect",n),this._onClose(t,e),this.socket.close(t)}else this.state==this.CONNECTING&&(this._onClose(t,e),this.socket.close(t))},a.prototype.emitRaw=function(t){t.cid=this._nextCallId(),t.callback&&(this._callbackMap[t.cid]=t);var e={event:t.event,data:t.data,cid:t.cid};return this.sendObject(e),t.cid},a.prototype._handleEventAckTimeout=function(t){var e="Event response for '"+t.event+"' timed out",n=new Error(e);n.type="timeout",t.cid&&delete this._callbackMap[t.cid];var o=t.callback;delete t.callback,o.call(t,n,t),this._onError(n)},a.prototype.emit=function(t,e,n,o){var r,i,s=this;o?(i=n,r=o):n instanceof Function?(i={},r=n):i=n;var c={event:t,data:e,callback:r};r&&!i.noTimeout&&(c.timeout=setTimeout(function(){s._handleEventAckTimeout(c)},this.options.ackTimeout));var a=null;return(this.state==this.OPEN||i.force)&&(a=this.emitRaw(c)),a},a.prototype.cancelPendingResponse=function(t){delete this._callbackMap[t]},a.prototype.parse=function(t){return i.parse(t)},a.prototype.stringify=function(t){return i.stringify(t)},a.prototype.send=function(t){this.socket.readyState!=this.socket.OPEN?this._onClose(1005):this.socket.send(t)},a.prototype.sendObject=function(t){this.send(this.stringify(t))},e.exports.SCTransport=a},{"./response":7,querystring:3,"sc-emitter":14,"sc-formatter":17,ws:18}],10:[function(t,e,n){"use strict";function o(){return arguments.length?o.from(arguments):void 0}function r(){}var i;i="An argument without append, prepend, or detach methods was given to `List";var s;s=o.prototype,o.of=function(){return o.from.call(this,arguments)},o.from=function(t){var e,n,o,r=new this;if(t&&(e=t.length))for(n=-1;++n<e;)o=t[n],null!==o&&void 0!==o&&r.append(o);return r},s.head=null,s.tail=null,s.toArray=function(){for(var t=this.head,e=[];t;)e.push(t),t=t.next;return e},s.prepend=function(t){if(!t)return!1;if(!t.append||!t.prepend||!t.detach)throw new Error(i+"#prepend`.");var e,n;return e=this,(n=e.head)?n.prepend(t):(t.detach(),t.list=e,e.head=t,t)},s.append=function(t){if(!t)return!1;if(!t.append||!t.prepend||!t.detach)throw new Error(i+"#append`.");var e,n,o;return e=this,(o=e.tail)?o.append(t):(n=e.head)?n.append(t):(t.detach(),t.list=e,e.head=t,t)},o.Item=r;var c=r.prototype;c.next=null,c.prev=null,c.list=null,c.detach=function(){var t=this,e=t.list,n=t.prev,o=t.next;return e?(e.tail===t&&(e.tail=n),e.head===t&&(e.head=o),e.tail===e.head&&(e.tail=null),n&&(n.next=o),o&&(o.prev=n),t.prev=t.next=t.list=null,t):t},c.prepend=function(t){if(!(t&&t.append&&t.prepend&&t.detach))throw new Error(i+"Item#prepend`.");var e=this,n=e.list,o=e.prev;return n?(t.detach(),o&&(t.prev=o,o.next=t),t.next=e,t.list=n,e.prev=t,e===n.head&&(n.head=t),n.tail||(n.tail=e),t):!1},c.append=function(t){if(!(t&&t.append&&t.prepend&&t.detach))throw new Error(i+"Item#append`.");var e=this,n=e.list,o=e.next;return n?(t.detach(),o&&(t.next=o,o.prev=t),t.prev=e,t.list=n,e.next=t,e!==n.tail&&n.tail||(n.tail=t),t):!1},e.exports=o},{}],11:[function(t,e,n){"use strict";e.exports=t("./_source/linked-list.js")},{"./_source/linked-list.js":10}],12:[function(t,e,n){var o=t("sc-emitter").SCEmitter;Object.create||(Object.create=t("./objectcreate"));var r=function(t,e){o.call(this),this.PENDING="pending",this.SUBSCRIBED="subscribed",this.UNSUBSCRIBED="unsubscribed",this.name=t,this.state=this.UNSUBSCRIBED,this.client=e};r.prototype=Object.create(o.prototype),r.prototype.getState=function(){return this.state},r.prototype.subscribe=function(){this.client.subscribe(this.name)},r.prototype.unsubscribe=function(){this.client.unsubscribe(this.name)},r.prototype.isSubscribed=function(t){return this.client.isSubscribed(this.name,t)},r.prototype.publish=function(t,e){this.client.publish(this.name,t,e)},r.prototype.watch=function(t){this.client.watch(this.name,t)},r.prototype.unwatch=function(t){this.client.unwatch(this.name,t)},r.prototype.watchers=function(){return this.client.watchers(this.name)},r.prototype.destroy=function(){this.client.destroyChannel(this.name)},e.exports.SCChannel=r},{"./objectcreate":13,"sc-emitter":14}],13:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],14:[function(t,e,n){var o=t("component-emitter");Object.create||(Object.create=t("./objectcreate"));var r=function(){o.call(this)};r.prototype=Object.create(o.prototype),r.prototype.emit=function(t){if("error"==t&&this.domain){var e=arguments[1];e||(e=new Error('Uncaught, unspecified "error" event.')),e.domainEmitter=this,e.domain=this.domain,e.domainThrown=!1,this.domain.emit("error",e)}o.prototype.emit.apply(this,arguments)},e.exports.SCEmitter=r},{"./objectcreate":16,"component-emitter":15}],15:[function(t,e,n){function o(t){return t?r(t):void 0}function r(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}e.exports=o,o.prototype.on=o.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},o.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o,r=0;r<n.length;r++)if(o=n[r],o===e||o.fn===e){n.splice(r,1);break}return this},o.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var o=0,r=n.length;r>o;++o)n[o].apply(this,e)}return this},o.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},o.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],16:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],17:[function(t,e,n){(function(t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";e.exports.parse=function(t){if(null==t)return null;var e=t.toString();try{return JSON.parse(e)}catch(n){}return e};var o=function(t){for(var e=new Uint8Array(t),o=e.length,r="",i=0;o>i;i+=3)r+=n[e[i]>>2],r+=n[(3&e[i])<<4|e[i+1]>>4],r+=n[(15&e[i+1])<<2|e[i+2]>>6],r+=n[63&e[i+2]];return o%3===2?r=r.substring(0,r.length-1)+"=":o%3===1&&(r=r.substring(0,r.length-2)+"=="),r},r=function(t,e){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1},i=function(e,n){if(n||(n=[]),r(e,n))throw new Error("Cannot traverse circular structure");var s=n.concat([e]);if(t.ArrayBuffer&&e instanceof t.ArrayBuffer)e={base64:!0,data:o(e)};else if(t.Buffer&&e instanceof t.Buffer)e={base64:!0,data:e.toString("base64")};else if(e instanceof Array)for(var c in e)e.hasOwnProperty(c)&&(e[c]=i(e[c],s));else if(e instanceof Object)for(var a in e)e.hasOwnProperty(a)&&(e[a]=i(e[a],s));return e};e.exports.stringify=function(t){var e=i(t);return JSON.stringify(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(t,e,n){function o(t,e,n){var o;return o=e?new i(t,e):new i(t)}var r=function(){return this}(),i=r.WebSocket||r.MozWebSocket;e.exports=i?o:null,i&&(o.prototype=i.prototype)},{}],19:[function(t,e,n){e.exports={name:"socketcluster-client",description:"SocketCluster JavaScript client",version:"2.3.7",homepage:"http://socketcluster.io",contributors:[{name:"Jonathan Gros-Dubois",email:"grosjona@yahoo.com.au"}],repository:{type:"git",url:"git://github.com/SocketCluster/socketcluster-client.git"},dependencies:{"linked-list":"0.1.0","sc-channel":"1.0.x","sc-emitter":"1.0.x","sc-formatter":"1.0.x",ws:"0.7.2"},readmeFilename:"README.md"}},{}]},{},[4])(4)}),function(){"use strict";var t;t=function(){function t(){}var e,n,o;return t.prototype.$inject=[],n=!1,o=null,e={autoReconnect:!0,protocol:"http",hostname:"127.0.0.1",port:8e3},t.prototype.$get=["socketCluster","$q","$rootScope","$log","$timeout",function(t,r,i,s,c){var a;return a={connect:function(i){return null==i&&(i={}),r(function(r,c){return angular.merge(e,i),n&&s.info("Socket :: Attempting connection..."),o=t.connect(e),o.on("error",function(t){return t!==!0?s.error("Socket :: Error >> "+t):void 0}),o.on("subscribeFail",function(t){return s.error("Socket :: Channel subscription error >> "+t)}),o.on("disconnect",function(t){return n?s.info("Socket :: Disconnection successful"):void 0}),o.on("connectAbort",function(t){return t="Socket :: Connection aborted >> "+t,s.error(t),c(t)}),o.on("connect",function(){return n&&s.info("Socket :: Connection successful"),r(!0)})})},disconnect:function(){return r(function(t,e){var r;return n&&s.info("Socket :: Attempting disconnect..."),null==o&&(r="Socket :: Error >> no socket connection established.",s.error(r),e(r)),o.disconnect(),t(!0)})},subscribe:function(t){return null==t&&(t=null),r(function(e,r){var c,a;return null==t&&(c="Socket :: Error >> no socket channel specified.",s.error(c),r(c)),null==o&&(c="Socket :: Error >> no socket connection established.",s.error(c),r(c)),n&&s.info("Socket :: Subscribe to channel "+t),a=function(t){return null!=t.$error?void(n&&s.error("Socket :: Event error >>",t)):(n&&s.info("Socket :: Event received >>",t),i.$apply(function(){return n&&s.info("Socket :: Rebroadcast event >> "+t.$event),i.$broadcast("socket:"+t.$event,t)}))},o.watch(t,a),o.on("single.publish",a),o.subscribe(t),e(!0)})},unsubscribe:function(t){return null==t&&(t=null),r(function(e,r){var i;return null==t&&(i="Socket :: Error >> no socket channel specified.",s.error(i),r(i)),null==o&&(i="Socket :: Error >> no socket connection established.",s.error(i),r(i)),n&&s.info("Socket :: Unsubscribe to channel "+t),o.unsubscribe(t),o.unwatch(t),e(!0)})},publish:function(t,e){return null==t&&(t=null),null==e&&(e={}),r(function(r,i){var c;return null==t&&(c="Socket :: Error >> no socket channel specified.",s.error(c),i(c)),null==o&&(c="Socket :: Error >> no socket connection established.",s.error(c),i(c)),n&&s.info("Socket :: Publish to channel "+t+" >>",e),o.publish(t,e,function(t){return null!=t?i(t):r(!0)})})},toggleDebugging:function(t){return null==t&&(t=!1),n=t},subscriptions:function(){return null==o?void s.error("Socket :: Error >> no socket connection established."):o.subscriptions()},isSubscribed:function(t){return null==o?void s.error("Socket :: Error >> no socket connection established."):o.isSubscribed(t)}}}],t}(),angular.module("sbb.components",[]).constant("socketCluster",socketCluster).provider("sbb.components.socket",t)}();